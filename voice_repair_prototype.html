<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>机井语音报修系统 - 移动端原型演示</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f5f6fa;
            min-height: 100vh;
            overflow-x: hidden;
        }

        .prototype-container {
            display: flex;
            min-height: 100vh;
        }

        /* 左侧导航栏 */
        .sidebar {
            width: 280px;
            background: linear-gradient(180deg, #2c3e50 0%, #34495e 100%);
            color: white;
            padding: 0;
            box-shadow: 2px 0 10px rgba(0,0,0,0.1);
            position: fixed;
            height: 100vh;
            overflow-y: auto;
        }

        .sidebar-header {
            padding: 20px;
            background: rgba(0,0,0,0.1);
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .sidebar-title {
            font-size: 18px;
            font-weight: 600;
            color: #ecf0f1;
        }

        .nav-section {
            padding: 5px 0;
        }

        .nav-section-title {
            padding: 12px 20px;
            font-size: 14px;
            color: #ecf0f1;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: space-between;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .nav-section-title:hover {
            background: rgba(255,255,255,0.05);
        }

        .nav-section-toggle {
            font-size: 12px;
            transition: transform 0.3s ease;
        }

        .nav-section.collapsed .nav-section-toggle {
            transform: rotate(-90deg);
        }

        .nav-section.collapsed .nav-section-content {
            display: none;
        }

        .nav-section-content {
            transition: all 0.3s ease;
        }

        .nav-item {
            padding: 10px 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            border-left: 3px solid transparent;
            display: flex;
            align-items: center;
            gap: 10px;
            color: #bdc3c7;
            font-size: 14px;
        }

        .nav-item:hover {
            background: rgba(255,255,255,0.1);
            border-left-color: #3498db;
            color: #ecf0f1;
        }

        .nav-item.active {
            background: rgba(52, 152, 219, 0.2);
            border-left-color: #3498db;
            color: #3498db;
        }

        .nav-sub-item {
            padding: 8px 40px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            color: #95a5a6;
            font-size: 13px;
        }

        .nav-sub-item:hover {
            background: rgba(255,255,255,0.05);
            color: #bdc3c7;
        }

        .nav-sub-item.active {
            background: rgba(52, 152, 219, 0.1);
            color: #3498db;
        }

        .nav-icon {
            width: 16px;
            text-align: center;
        }

        /* 右侧手机展示区域 */
        .phone-display {
            flex: 1;
            margin-left: 280px;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 30px;
            background: #ffffff;
        }

        .phone-frame {
            width: 360px;
            height: 720px;
            background: #000;
            border-radius: 36px;
            padding: 8px;
            box-shadow: 0 15px 40px rgba(0,0,0,0.2);
            position: relative;
        }

        .phone-screen {
            width: 100%;
            height: 100%;
            background: #fff;
            border-radius: 28px;
            overflow: hidden;
            position: relative;
        }

        .container {
            width: 100%;
            height: 100%;
            position: relative;
        }

        .header {
            background: linear-gradient(135deg, #4285f4 0%, #357ae8 100%);
            color: white;
            padding: 15px 20px;
            text-align: center;
            font-size: 18px;
            font-weight: 600;
        }

        .page {
            display: none;
            height: calc(100% - 60px);
            overflow-y: auto;
        }

        .page.active {
            display: block;
        }

        /* 入口页面样式 */
        .entry-page {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 50px 20px;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            height: 100%;
        }

        .repair-buttons {
            display: flex;
            flex-direction: column;
            gap: 40px;
            align-items: center;
        }

        .repair-btn {
            width: 140px;
            height: 140px;
            border-radius: 50%;
            border: none;
            font-size: 16px;
            font-weight: 600;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .voice-btn {
            background: linear-gradient(135deg, #4285f4 0%, #357ae8 100%);
            box-shadow: 0 8px 25px rgba(66, 133, 244, 0.3);
        }

        .voice-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 35px rgba(66, 133, 244, 0.4);
        }

        .manual-btn {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            color: #6c757d;
            border: 2px solid #dee2e6;
        }

        .btn-icon {
            font-size: 28px;
        }

        /* 语音报修页面样式 */
        .voice-page {
            display: flex;
            flex-direction: column;
            height: calc(100% - 60px);
            padding: 0;
            overflow: hidden;
        }

        .voice-guide {
            background: linear-gradient(135deg, #e3f2fd 0%, #f3e5f5 100%);
            padding: 15px 20px;
            text-align: center;
            flex-shrink: 0;
        }

        .guide-title {
            font-size: 16px;
            font-weight: 600;
            color: #333;
            margin-bottom: 10px;
        }

        .guide-content {
            font-size: 13px;
            color: #666;
            line-height: 1.5;
            margin-bottom: 10px;
        }

        .guide-keywords {
            color: #e74c3c;
            font-weight: 600;
        }

        .guide-tips {
            font-size: 12px;
            color: #999;
            margin-top: 8px;
        }

        /* 聊天区域样式 */
        .chat-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            padding: 10px 15px;
            overflow: hidden;
            min-height: 0;
        }

        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding-bottom: 10px;
            min-height: 150px;
        }

        .message {
            margin-bottom: 15px;
            display: flex;
            flex-direction: column;
        }

        .message.ai {
            align-items: flex-start;
        }

        .message.user {
            align-items: flex-end;
        }

        .message-bubble {
            max-width: 80%;
            padding: 12px 16px;
            border-radius: 18px;
            font-size: 14px;
            line-height: 1.4;
            word-wrap: break-word;
        }

        .message.ai .message-bubble {
            background: #f0f0f0;
            color: #333;
            border-bottom-left-radius: 8px;
        }

        .message.user .message-bubble {
            background: #4285f4;
            color: white;
            border-bottom-right-radius: 8px;
        }

        .message-time {
            font-size: 11px;
            color: #999;
            margin-top: 4px;
            margin-bottom: 0;
        }

        .message.ai .message-time {
            margin-left: 16px;
        }

        .message.user .message-time {
            margin-right: 16px;
        }

        /* 输入区域样式 */
        .voice-input-area {
            padding: 10px 15px 15px;
            border-top: 1px solid #e0e0e0;
            background: white;
            flex-shrink: 0;
        }

        .input-controls {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .voice-record-btn {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            border: none;
            background: linear-gradient(135deg, #4285f4 0%, #357ae8 100%);
            color: white;
            font-size: 24px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .voice-record-btn:active {
            transform: scale(0.95);
            background: linear-gradient(135deg, #3367d6 0%, #2b5ce6 100%);
        }

        .voice-record-btn.recording {
            animation: pulse 1.5s infinite;
            background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
        }

        .input-status {
            flex: 1;
            font-size: 13px;
            color: #666;
            margin-left: 10px;
        }

        .submit-area {
            margin-top: 15px;
            text-align: center;
        }

        .submit-conversation-btn {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 25px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            display: none;
            transition: all 0.3s ease;
        }

        .submit-conversation-btn.show {
            display: inline-block;
        }

        .submit-conversation-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(40, 167, 69, 0.3);
        }

        /* 信息收集状态 */
        .info-status {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 10px 12px;
            margin: 8px 0;
            font-size: 12px;
            flex-shrink: 0;
        }

        .info-item {
            display: flex;
            justify-content: space-between;
            margin: 6px 0;
        }

        .info-label {
            color: #666;
        }

        .info-value {
            color: #333;
            font-weight: 500;
        }

        .info-value.missing {
            color: #e74c3c;
        }

        .info-value.collected {
            color: #28a745;
        }

        /* 处理页面样式 */
        .processing-page {
            padding: 30px 20px;
            text-align: center;
        }

        .processing-visual {
            margin: 30px 0;
        }

        .loading-circle {
            width: 80px;
            height: 80px;
            border: 6px solid #f3f3f3;
            border-top: 6px solid #4285f4;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .process-steps {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 15px;
            margin: 20px 0;
            text-align: left;
        }

        .step {
            display: flex;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid #dee2e6;
            font-size: 14px;
        }

        .step:last-child {
            border-bottom: none;
        }

        .step-icon {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            margin-right: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            color: white;
        }

        .step-icon.completed {
            background: #28a745;
        }

        .step-icon.processing {
            background: #4285f4;
            animation: pulse 1.5s infinite;
        }

        .step-icon.pending {
            background: #dee2e6;
            color: #6c757d;
        }

        /* 拍照弹窗样式 */
        .photo-modal {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .photo-modal.show {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 20px;
            padding: 25px 15px;
            margin: 20px;
            text-align: center;
            max-width: 250px;
        }

        .modal-icon {
            font-size: 40px;
            color: #4285f4;
            margin-bottom: 15px;
        }

        .modal-buttons {
            display: flex;
            gap: 12px;
            justify-content: center;
            margin-top: 20px;
        }

        .modal-btn {
            padding: 10px 16px;
            border: none;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .photo-btn-yes {
            background: linear-gradient(135deg, #4285f4 0%, #357ae8 100%);
            color: white;
        }

        .photo-btn-no {
            background: #f8f9fa;
            color: #6c757d;
            border: 1px solid #dee2e6;
        }

        /* 完成页面样式 */
        .complete-page {
            padding: 40px 20px;
            text-align: center;
        }

        .success-icon {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            margin: 0 auto 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 32px;
        }

        .order-info {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 20px;
            margin: 25px 0;
            text-align: left;
        }

        .info-row {
            display: flex;
            justify-content: space-between;
            padding: 6px 0;
            border-bottom: 1px solid #dee2e6;
            font-size: 14px;
        }

        .info-row:last-child {
            border-bottom: none;
        }

        .info-label {
            color: #6c757d;
            font-weight: 500;
        }

        .info-value {
            color: #333;
            font-weight: 600;
        }

        .back-btn {
            background: linear-gradient(135deg, #6c757d 0%, #495057 100%);
            color: white;
            padding: 12px 30px;
            border: none;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            margin-top: 25px;
        }

        /* 定位权限弹窗样式 */
        .location-modal {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: none;
            align-items: flex-end;
            justify-content: center;
            z-index: 2000;
            animation: fadeIn 0.3s ease;
        }

        .location-modal.show {
            display: flex;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideUp {
            from { transform: translateY(100%); }
            to { transform: translateY(0); }
        }

        .location-modal-content {
            background: white;
            width: 100%;
            max-width: 100%;
            border-radius: 20px 20px 0 0;
            padding: 0;
            margin: 0;
            animation: slideUp 0.3s ease;
            box-shadow: 0 -4px 20px rgba(0, 0, 0, 0.15);
        }

        .location-modal-header {
            padding: 20px 20px 15px;
            border-bottom: 1px solid #f0f0f0;
            text-align: center;
            position: relative;
        }

        .location-modal-title {
            font-size: 17px;
            font-weight: 600;
            color: #333;
            margin: 0;
        }

        .location-modal-close {
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            font-size: 18px;
            color: #999;
            cursor: pointer;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .location-modal-body {
            padding: 20px;
        }

        .location-description {
            font-size: 14px;
            color: #666;
            line-height: 1.5;
            margin-bottom: 25px;
            text-align: left;
        }

        .location-buttons {
            display: flex;
            gap: 10px;
            margin: 0;
        }

        .location-btn {
            flex: 1;
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .location-deny-btn {
            background: #f7f7f7;
            color: #333;
        }

        .location-deny-btn:hover {
            background: #e8e8e8;
        }

        .location-allow-btn {
            background: #07c160;
            color: white;
        }

        .location-allow-btn:hover {
            background: #06ad56;
        }

        /* 机井确认页面样式 */
        .well-confirm-page {
            padding: 30px 20px;
            text-align: center;
        }

        .well-info {
            background: #e8f4f8;
            border-radius: 15px;
            padding: 20px;
            margin: 25px 0;
            border: 2px solid #4285f4;
        }

        .well-number {
            font-size: 24px;
            font-weight: bold;
            color: #4285f4;
            margin-bottom: 10px;
        }

        .well-details {
            font-size: 12px;
            color: #6c757d;
            line-height: 1.5;
        }

        .confirm-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin: 25px 0;
        }

        .confirm-btn {
            padding: 12px 24px;
            border: none;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .yes-btn {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
        }

        .no-btn {
            background: linear-gradient(135deg, #6c757d 0%, #495057 100%);
            color: white;
        }

        /* 信息确认页面样式 */
        .confirm-info-page {
            padding: 30px 20px;
        }

        .info-summary {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            text-align: left;
        }

        .summary-title {
            font-size: 16px;
            font-weight: 600;
            color: #333;
            margin-bottom: 15px;
            text-align: center;
        }

        .voice-content {
            background: #e8f4f8;
            border-radius: 10px;
            padding: 15px;
            margin: 10px 0;
            border-left: 4px solid #4285f4;
        }

        .voice-content-text {
            font-size: 14px;
            color: #333;
            line-height: 1.5;
        }

        .edit-btn {
            background: #f8f9fa;
            color: #6c757d;
            border: 1px solid #dee2e6;
            padding: 8px 16px;
            border-radius: 15px;
            font-size: 12px;
            cursor: pointer;
            margin-top: 10px;
        }

        /* 照片上传页面样式 */
        .photo-upload-page {
            padding: 30px 20px;
            text-align: center;
        }

        .photo-preview {
            width: 200px;
            height: 150px;
            border: 2px dashed #dee2e6;
            border-radius: 10px;
            margin: 20px auto;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #f8f9fa;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .photo-preview:hover {
            border-color: #4285f4;
            background: #e8f4f8;
        }

        .photo-preview.has-image {
            border-style: solid;
            border-color: #4285f4;
        }

        .upload-icon {
            font-size: 40px;
            color: #6c757d;
        }

        .manual-input {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            text-align: left;
        }

        .input-field {
            width: 100%;
            padding: 10px;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            margin: 8px 0;
            font-size: 14px;
        }

        .input-label {
            font-size: 12px;
            color: #6c757d;
            margin-bottom: 5px;
            display: block;
        }
    </style>
</head>
<body>
    <div class="prototype-container">
        <!-- 左侧导航栏 -->
        <div class="sidebar">
            <div class="sidebar-header">
                <div class="sidebar-title">页面导航</div>
            </div>
            
            <div class="nav-section">
                <div class="nav-section-title" onclick="toggleSection(this)">
                    <span>💬 报修管理</span>
                    <span class="nav-section-toggle">▼</span>
                </div>
                <div class="nav-section-content">
                    <div class="nav-item active" onclick="showPageAndHighlight('entryPage', this)">
                        <span class="nav-icon">🏠</span>
                        <span>报修入口</span>
                    </div>
                    <div class="nav-sub-item" onclick="triggerLocationModal(this)">
                        <span class="nav-icon">📍</span>
                        <span>获取定位</span>
                    </div>
                    <div class="nav-sub-item" onclick="showPageAndHighlight('wellConfirmPage', this)">
                        <span class="nav-icon">🏗️</span>
                        <span>机井确认</span>
                    </div>
                    <div class="nav-sub-item" onclick="showPageAndHighlight('voicePage', this)">
                        <span class="nav-icon">🎤</span>
                        <span>AI语音报修</span>
                    </div>
                    <div class="nav-sub-item" onclick="showPageAndHighlight('confirmPage', this)">
                        <span class="nav-icon">✅</span>
                        <span>信息确认</span>
                    </div>
                    <div class="nav-sub-item" onclick="showPageAndHighlight('photoPage', this)">
                        <span class="nav-icon">📷</span>
                        <span>上传照片</span>
                    </div>
                    <div class="nav-sub-item" onclick="showPageAndHighlight('processPage', this)">
                        <span class="nav-icon">⚙️</span>
                        <span>AI处理中</span>
                    </div>
                    <div class="nav-sub-item" onclick="showPageAndHighlight('completePage', this)">
                        <span class="nav-icon">✅</span>
                        <span>完成报修</span>
                    </div>
                    <div class="nav-item">
                        <span class="nav-icon">📝</span>
                        <span>手动填报</span>
                    </div>
                </div>
            </div>

            <div class="nav-section collapsed">
                <div class="nav-section-title" onclick="toggleSection(this)">
                    <span>📋 工单管理（本次不做）</span>
                    <span class="nav-section-toggle">▼</span>
                </div>
                <div class="nav-section-content">
                    <div class="nav-item">
                        <span class="nav-icon">📋</span>
                        <span>工单列表</span>
                    </div>
                    <div class="nav-sub-item">
                        <span class="nav-icon">🔍</span>
                        <span>待处理工单</span>
                    </div>
                    <div class="nav-sub-item">
                        <span class="nav-icon">⏳</span>
                        <span>处理中工单</span>
                    </div>
                    <div class="nav-sub-item">
                        <span class="nav-icon">✅</span>
                        <span>已完成工单</span>
                    </div>
                    <div class="nav-item">
                        <span class="nav-icon">🔧</span>
                        <span>维修记录</span>
                    </div>
                </div>
            </div>

            <div class="nav-section collapsed">
                <div class="nav-section-title" onclick="toggleSection(this)">
                    <span>📊 数据分析（本次不做）</span>
                    <span class="nav-section-toggle">▼</span>
                </div>
                <div class="nav-section-content">
                    <div class="nav-item">
                        <span class="nav-icon">📈</span>
                        <span>数据统计</span>
                    </div>
                    <div class="nav-sub-item">
                        <span class="nav-icon">📊</span>
                        <span>报修趋势</span>
                    </div>
                    <div class="nav-sub-item">
                        <span class="nav-icon">⏱️</span>
                        <span>响应时间</span>
                    </div>
                    <div class="nav-sub-item">
                        <span class="nav-icon">🎯</span>
                        <span>完成率</span>
                    </div>
                    <div class="nav-item">
                        <span class="nav-icon">📝</span>
                        <span>报表生成</span>
                    </div>
                </div>
            </div>

            <div class="nav-section collapsed">
                <div class="nav-section-title" onclick="toggleSection(this)">
                    <span>⚙️ 系统设置（本次不做）</span>
                    <span class="nav-section-toggle">▼</span>
                </div>
                <div class="nav-section-content">
                    <div class="nav-item">
                        <span class="nav-icon">👤</span>
                        <span>用户管理</span>
                    </div>
                    <div class="nav-sub-item">
                        <span class="nav-icon">👥</span>
                        <span>用户列表</span>
                    </div>
                    <div class="nav-sub-item">
                        <span class="nav-icon">🔐</span>
                        <span>权限配置</span>
                    </div>
                    <div class="nav-item">
                        <span class="nav-icon">🔧</span>
                        <span>系统配置</span>
                    </div>
                    <div class="nav-sub-item">
                        <span class="nav-icon">🔊</span>
                        <span>语音配置</span>
                    </div>
                    <div class="nav-sub-item">
                        <span class="nav-icon">🤖</span>
                        <span>AI模型设置</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- 右侧手机展示区域 -->
        <div class="phone-display">
            <div class="phone-frame">
                <div class="phone-screen">
                    <div class="container">
                        <div class="header">
                            <span id="headerTitle">机井报修</span>
                        </div>

                        <!-- 入口页面 -->
                        <div class="page active" id="entryPage">
                            <div class="entry-page">
                                <div class="repair-buttons">
                                    <button class="repair-btn voice-btn" onclick="startVoiceRepair()">
                                        <div class="btn-icon">🎤</div>
                                        <div>AI语音报修</div>
                                    </button>
                                    <button class="repair-btn manual-btn">
                                        <div class="btn-icon">✏️</div>
                                        <div>手动填报</div>
                                    </button>
                                </div>
                            </div>
                        </div>



                        <!-- 机井确认页面 -->
                        <div class="page" id="wellConfirmPage">
                            <div class="well-confirm-page">
                                <h3 style="margin-bottom: 15px; color: #333; font-size: 16px;">确认机井位置</h3>
                                <p style="color: #6c757d; margin-bottom: 15px; font-size: 12px;">根据您的位置，为您找到最近的机井</p>
                                
                                <div class="well-info">
                                    <div class="well-number">01号机井</div>
                                    <div class="well-details">
                                        距离：约50米<br>
                                        位置：村东南角农田<br>
                                        负责人：张师傅 138****5678
                                    </div>
                                </div>

                                <p style="color: #333; margin-bottom: 20px; font-size: 14px;">请问是为这口机井报修吗？</p>

                                <div class="confirm-buttons">
                                    <button class="confirm-btn yes-btn" onclick="confirmWell(true)">是的</button>
                                    <button class="confirm-btn no-btn" onclick="confirmWell(false)">不是</button>
                                </div>
                            </div>
                        </div>

                        <!-- 手动选择机井页面 -->
                        <div class="page" id="manualWellPage">
                            <div class="manual-input">
                                <h3 style="margin-bottom: 15px; color: #333; font-size: 16px; text-align: center;">手动选择机井</h3>
                                
                                <label class="input-label">机井编号</label>
                                <input type="text" class="input-field" placeholder="请输入机井编号（如：01号机井）" id="wellNumberInput">
                                
                                <label class="input-label">大概位置</label>
                                <input type="text" class="input-field" placeholder="请输入机井大概位置" id="wellLocationInput">
                                
                                <div style="text-align: center; margin-top: 25px;">
                                    <button class="confirm-btn yes-btn" onclick="confirmManualWell()">确认选择</button>
                                    <button class="confirm-btn no-btn" onclick="goToManualReport()" style="margin-left: 15px;">转为手动填报</button>
                                </div>
                            </div>
                        </div>

                        <!-- 语音报修页面 -->
                        <div class="page" id="voicePage">
                            <div class="voice-page">
                                <!-- 引导提示区域 -->
                                <div class="voice-guide">
                                    <div class="guide-title">AI语音报修指引</div>
                                    <div class="guide-content">
                                        长按录音键，表达清晰，尽量使用普通话<br>
                                        请说出：<span class="guide-keywords">故障类型</span>、<span class="guide-keywords">姓名</span>、<span class="guide-keywords">电话</span>等信息
                                    </div>
                                    <div class="guide-tips">系统会根据您的语音内容智能提问，收集完整信息</div>
                                </div>

                                <!-- 聊天对话区域 -->
                                <div class="chat-container">
                                    <div class="chat-messages" id="chatMessages">
                                        <div class="message ai">
                                            <div class="message-bubble">
                                                您好！我是AI助手，请告诉我机井的故障情况，我会帮您记录报修信息。
                                            </div>
                                            <div class="message-time">刚刚</div>
                                        </div>
                                    </div>

                                    <!-- 信息收集状态 -->
                                    <div class="info-status" id="infoStatus">
                                        <div class="info-item">
                                            <span class="info-label">故障类型:</span>
                                            <span class="info-value missing" id="faultTypeStatus">待收集</span>
                                        </div>
                                        <div class="info-item">
                                            <span class="info-label">联系姓名:</span>
                                            <span class="info-value missing" id="nameStatus">待收集</span>
                                        </div>
                                        <div class="info-item">
                                            <span class="info-label">联系电话:</span>
                                            <span class="info-value missing" id="phoneStatus">待收集</span>
                                        </div>
                                    </div>
                                </div>

                                <!-- 输入区域 -->
                                <div class="voice-input-area">
                                    <div class="input-controls">
                                        <button class="voice-record-btn" id="voiceBtn"
                                                onmousedown="startRecording()" 
                                                onmouseup="stopRecording()"
                                                ontouchstart="startRecording()" 
                                                ontouchend="stopRecording()">
                                            🎤
                                        </button>
                                        <div class="input-status" id="inputStatus">长按录音，松开发送</div>
                                    </div>
                                    
                                    <div class="submit-area">
                                        <button class="submit-conversation-btn" id="submitConversationBtn" onclick="submitConversation()">
                                            提交报修信息
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- 信息确认页面 -->
                        <div class="page" id="confirmPage">
                            <div class="confirm-info-page">
                                <div class="summary-title">请确认报修信息</div>
                                
                                <div class="info-summary">
                                    <div class="info-row">
                                        <span class="info-label">机井编号</span>
                                        <span class="info-value" id="confirmWellNumber">01号机井</span>
                                    </div>
                                    <div class="info-row">
                                        <span class="info-label">机井位置</span>
                                        <span class="info-value" id="confirmWellLocation">村东南角农田</span>
                                    </div>
                                </div>

                                <div class="voice-content">
                                    <div style="font-weight: 600; margin-bottom: 10px;">语音识别结果：</div>
                                    <div class="voice-content-text" id="confirmVoiceText">
                                        机井设备损坏，不通电，请尽快安排维修人员过来检查，情况比较紧急。
                                    </div>
                                    <button class="edit-btn" onclick="reRecordVoice()">重新录音</button>
                                </div>

                                <div style="text-align: center; margin-top: 25px;">
                                    <button class="confirm-btn yes-btn" onclick="confirmInfoComplete()" style="margin-right: 15px;">信息完整，继续</button>
                                    <button class="confirm-btn no-btn" onclick="reRecordVoice()">重新录音</button>
                                </div>
                            </div>
                        </div>

                        <!-- 照片上传页面 -->
                        <div class="page" id="photoPage">
                            <div class="photo-upload-page">
                                <h3 style="margin-bottom: 15px; color: #333; font-size: 16px;">上传故障照片</h3>
                                <p style="color: #6c757d; margin-bottom: 25px; font-size: 12px;">拍摄故障现场照片有助于维修人员快速定位问题</p>
                                
                                <div class="photo-preview" id="photoPreview" onclick="takePhoto()">
                                    <div class="upload-icon">📷</div>
                                </div>
                                <p style="color: #6c757d; font-size: 11px; margin-bottom: 25px;">点击上方区域拍照</p>

                                <div class="confirm-buttons">
                                    <button class="confirm-btn yes-btn" onclick="uploadPhoto()" id="uploadBtn" style="display: none;">上传照片</button>
                                    <button class="confirm-btn no-btn" onclick="skipPhoto()">跳过上传</button>
                                </div>
                            </div>
                        </div>

                        <!-- 处理页面 -->
                        <div class="page" id="processPage">
                            <div class="processing-page">
                                <h3 style="margin-bottom: 15px; color: #333; font-size: 16px;">正在处理您的报修信息</h3>
                                
                                <div class="processing-visual">
                                    <div class="loading-circle"></div>
                                </div>

                                <div class="process-steps">
                                    <div class="step">
                                        <div class="step-icon completed">✓</div>
                                        <div>语音识别完成</div>
                                    </div>
                                    <div class="step">
                                        <div class="step-icon processing" id="aiStep">🤖</div>
                                        <div>AI智能分析中...</div>
                                    </div>
                                    <div class="step">
                                        <div class="step-icon pending" id="orderStep">📋</div>
                                        <div>生成维修工单</div>
                                    </div>
                                    <div class="step">
                                        <div class="step-icon pending" id="dispatchStep">👨‍🔧</div>
                                        <div>派发给维修人员</div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- 完成页面 -->
                        <div class="page" id="completePage">
                            <div class="complete-page">
                                <div class="success-icon">✓</div>
                                <h2 style="color: #28a745; margin-bottom: 8px; font-size: 18px;">报修成功</h2>
                                <p style="color: #6c757d; margin-bottom: 25px; font-size: 12px;">工单已生成并派发给维修人员</p>

                                <div class="order-info">
                                    <div class="info-row">
                                        <span class="info-label">工单编号</span>
                                        <span class="info-value" id="orderNumber">WO202312150001</span>
                                    </div>
                                    <div class="info-row">
                                        <span class="info-label">机井编号</span>
                                        <span class="info-value" id="wellNumber">01号机井</span>
                                    </div>
                                    <div class="info-row">
                                        <span class="info-label">故障类型</span>
                                        <span class="info-value" id="faultType">设备损坏，不通电</span>
                                    </div>
                                    <div class="info-row">
                                        <span class="info-label">紧急程度</span>
                                        <span class="info-value" id="urgency">高</span>
                                    </div>
                                    <div class="info-row">
                                        <span class="info-label">预计完成</span>
                                        <span class="info-value" id="estimatedTime">2小时内</span>
                                    </div>
                                </div>

                                <button class="back-btn" onclick="resetToEntry()">返回首页</button>
                            </div>
                        </div>

                        <!-- 定位权限弹窗 -->
                        <div class="location-modal" id="locationModal">
                            <div class="location-modal-content">
                                <div class="location-modal-header">
                                    <h3 class="location-modal-title">机井报修申请</h3>
                                    <button class="location-modal-close" onclick="closeLocationModal()">×</button>
                                </div>
                                <div class="location-modal-body">
                                    <div class="location-description">
                                        <strong>获取你的位置信息</strong><br><br>
                                        将获取你的具体位置信息，用于自动为您匹配距离最近的机井设备
                                    </div>
                                    <div class="location-buttons">
                                        <button class="location-btn location-deny-btn" onclick="denyLocation()">拒绝</button>
                                        <button class="location-btn location-allow-btn" onclick="allowLocation()">允许</button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- 确认弹窗 -->
                        <div class="photo-modal" id="confirmModal">
                            <div class="modal-content">
                                <div class="modal-icon">❓</div>
                                <h3 style="margin-bottom: 8px; font-size: 16px;">信息不完整</h3>
                                <p style="color: #6c757d; font-size: 12px;">语音识别的故障信息可能不够详细，建议重新录音</p>
                                <div class="modal-buttons">
                                    <button class="modal-btn photo-btn-yes" onclick="reRecordVoice()">重新录音</button>
                                    <button class="modal-btn photo-btn-no" onclick="forceSubmit()">强制提交</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let isRecording = false;
        let recordingTimer;
        let currentStep = 0;
        let hasPhoto = false;
        let currentWellInfo = {
            number: '01号机井',
            location: '村东南角农田',
            distance: '约50米'
        };

        function showPage(pageId) {
            document.querySelectorAll('.page').forEach(page => {
                page.classList.remove('active');
            });
            document.getElementById(pageId).classList.add('active');
        }

        function updateHeader(title) {
            document.getElementById('headerTitle').textContent = title;
        }

        function toggleSection(element) {
            const section = element.parentElement;
            section.classList.toggle('collapsed');
        }

        function showPageAndHighlight(pageId, navElement) {
            // 移除所有导航项的active状态
            document.querySelectorAll('.nav-item, .nav-sub-item').forEach(item => {
                item.classList.remove('active');
            });
            
            // 添加当前导航项的active状态
            navElement.classList.add('active');
            
            // 显示对应页面
            showPage(pageId);
            
            // 更新标题
            const titles = {
                'entryPage': '机井报修',
                'wellConfirmPage': '确认机井',
                'manualWellPage': '选择机井',
                'voicePage': 'AI语音报修',
                'confirmPage': '确认信息',
                'photoPage': '上传照片',
                'processPage': '处理中',
                'completePage': '报修完成'
            };
            updateHeader(titles[pageId] || '机井报修');
        }

        function startVoiceRepair() {
            // 显示定位权限弹窗
            document.getElementById('locationModal').classList.add('show');
            
            // 同时更新导航状态
            document.querySelectorAll('.nav-item, .nav-sub-item').forEach(item => {
                item.classList.remove('active');
            });
            document.querySelectorAll('.nav-sub-item')[0].classList.add('active');
        }

        function closeLocationModal() {
            document.getElementById('locationModal').classList.remove('show');
        }

        function allowLocation() {
            // 关闭弹窗
            closeLocationModal();
            
            // 显示机井确认页面
            showPage('wellConfirmPage');
            updateHeader('确认机井');
            
            // 更新导航状态
            document.querySelectorAll('.nav-item, .nav-sub-item').forEach(item => {
                item.classList.remove('active');
            });
            document.querySelectorAll('.nav-sub-item')[1].classList.add('active');
        }

        function denyLocation() {
            // 关闭弹窗
            closeLocationModal();
            
            // 显示手动选择机井页面
            showPage('manualWellPage');
            updateHeader('选择机井');
            
            // 更新导航状态
            document.querySelectorAll('.nav-item, .nav-sub-item').forEach(item => {
                item.classList.remove('active');
            });
            document.querySelectorAll('.nav-sub-item')[1].classList.add('active');
        }

        function confirmWell(isCorrect) {
            if (isCorrect) {
                showPage('voicePage');
                updateHeader('语音报修');
                
                // 更新导航状态
                document.querySelectorAll('.nav-item, .nav-sub-item').forEach(item => {
                    item.classList.remove('active');
                });
                document.querySelectorAll('.nav-sub-item')[2].classList.add('active');
            } else {
                showPage('manualWellPage');
                updateHeader('选择机井');
            }
        }

        function confirmManualWell() {
            const wellNumber = document.getElementById('wellNumberInput').value;
            const wellLocation = document.getElementById('wellLocationInput').value;
            
            if (wellNumber && wellLocation) {
                currentWellInfo.number = wellNumber;
                currentWellInfo.location = wellLocation;
                currentWellInfo.distance = '手动输入';
                
                showPage('voicePage');
                updateHeader('语音报修');
                
                // 更新导航状态
                document.querySelectorAll('.nav-item, .nav-sub-item').forEach(item => {
                    item.classList.remove('active');
                });
                document.querySelectorAll('.nav-sub-item')[2].classList.add('active');
            } else {
                alert('请填写完整的机井信息');
            }
        }

        function goToManualReport() {
            alert('转到手动填报功能（此功能未在原型中实现）');
        }

        function triggerLocationModal(navElement) {
            // 更新导航状态
            document.querySelectorAll('.nav-item, .nav-sub-item').forEach(item => {
                item.classList.remove('active');
            });
            navElement.classList.add('active');
            
            // 显示定位权限弹窗
            document.getElementById('locationModal').classList.add('show');
        }

        // 对话管理
        let conversationState = {
            faultType: '',
            userName: '',
            userPhone: '',
            messages: [],
            currentStep: 0
        };

        const aiQuestions = [
            {
                check: (state) => !state.faultType,
                question: "请详细描述一下故障类型，比如：井盖丢失、不通电、设备损坏等。"
            },
            {
                check: (state) => !state.userName,
                question: "请提供您的姓名，方便我们联系您。"
            },
            {
                check: (state) => !state.userPhone,
                question: "请提供您的联系电话，方便维修人员联系您。"
            }
        ];

        function startRecording() {
            if (!isRecording) {
                isRecording = true;
                const voiceBtn = document.getElementById('voiceBtn');
                const inputStatus = document.getElementById('inputStatus');
                
                voiceBtn.classList.add('recording');
                voiceBtn.textContent = '🔴';
                inputStatus.textContent = '正在录音...松开发送';
            }
        }

        function stopRecording() {
            if (isRecording) {
                isRecording = false;
                const voiceBtn = document.getElementById('voiceBtn');
                const inputStatus = document.getElementById('inputStatus');
                
                voiceBtn.classList.remove('recording');
                voiceBtn.textContent = '🎤';
                inputStatus.textContent = '正在识别...';
                
                // 模拟语音识别和对话
                setTimeout(() => {
                    processVoiceInput();
                    inputStatus.textContent = '长按录音，松开发送';
                }, 1500);
            }
        }

        function processVoiceInput() {
            // 模拟不同的语音输入场景
            const step = conversationState.currentStep;
            let userMessage = '';
            
            if (step === 0) {
                userMessage = '01号机井不通电了，设备完全没有反应，我是张师傅，电话是138****5678';
                // 智能提取信息
                conversationState.faultType = '不通电';
                conversationState.userName = '张师傅';
                conversationState.userPhone = '138****5678';
            } else if (step === 1) {
                userMessage = '井盖丢失了，很危险';
                conversationState.faultType = '井盖丢失';
            } else if (step === 2) {
                userMessage = '我叫李明';
                conversationState.userName = '李明';
            } else if (step === 3) {
                userMessage = '我的电话是139****1234';
                conversationState.userPhone = '139****1234';
            }
            
            // 添加用户消息
            addMessage('user', userMessage);
            
            // 更新信息状态
            updateInfoStatus();
            
            conversationState.currentStep++;
            
            // AI回复
            setTimeout(() => {
                const missingInfo = aiQuestions.find(q => q.check(conversationState));
                if (missingInfo) {
                    addMessage('ai', missingInfo.question);
                } else {
                    addMessage('ai', '信息收集完成！请确认无误后提交报修。');
                    document.getElementById('submitConversationBtn').classList.add('show');
                }
            }, 800);
        }

        function addMessage(type, content) {
            const chatMessages = document.getElementById('chatMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${type}`;
            
            const now = new Date();
            const timeStr = now.getHours().toString().padStart(2, '0') + ':' + 
                           now.getMinutes().toString().padStart(2, '0');
            
            messageDiv.innerHTML = `
                <div class="message-bubble">${content}</div>
                <div class="message-time">${timeStr}</div>
            `;
            
            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        function updateInfoStatus() {
            document.getElementById('faultTypeStatus').textContent = 
                conversationState.faultType || '待收集';
            document.getElementById('faultTypeStatus').className = 
                'info-value ' + (conversationState.faultType ? 'collected' : 'missing');
                
            document.getElementById('nameStatus').textContent = 
                conversationState.userName || '待收集';
            document.getElementById('nameStatus').className = 
                'info-value ' + (conversationState.userName ? 'collected' : 'missing');
                
            document.getElementById('phoneStatus').textContent = 
                conversationState.userPhone || '待收集';
            document.getElementById('phoneStatus').className = 
                'info-value ' + (conversationState.userPhone ? 'collected' : 'missing');
        }

        function submitConversation() {
            showPage('confirmPage');
            updateHeader('确认信息');
            
            // 更新确认页面的信息
            document.getElementById('confirmWellNumber').textContent = currentWellInfo.number;
            document.getElementById('confirmWellLocation').textContent = currentWellInfo.location;
            document.getElementById('confirmVoiceText').textContent = 
                `故障类型：${conversationState.faultType}\n联系人：${conversationState.userName}\n电话：${conversationState.userPhone}`;
            
            // 更新导航状态
            document.querySelectorAll('.nav-item, .nav-sub-item').forEach(item => {
                item.classList.remove('active');
            });
            document.querySelectorAll('.nav-sub-item')[3].classList.add('active');
        }

        function checkVoiceComplete() {
            // 这个函数现在由 submitConversation 替代
            submitConversation();
        }

        function reRecordVoice() {
            document.getElementById('confirmModal').classList.remove('show');
            showPage('voicePage');
            updateHeader('AI语音报修');
            
            // 重置对话状态
            conversationState = {
                faultType: '',
                userName: '',
                userPhone: '',
                messages: [],
                currentStep: 0
            };
            
            // 重置聊天界面
            const chatMessages = document.getElementById('chatMessages');
            chatMessages.innerHTML = `
                <div class="message ai">
                    <div class="message-bubble">
                        您好！我是AI助手，请告诉我机井的故障情况，我会帮您记录报修信息。
                    </div>
                    <div class="message-time">刚刚</div>
                </div>
            `;
            
            // 重置信息状态
            updateInfoStatus();
            
            // 隐藏提交按钮
            document.getElementById('submitConversationBtn').classList.remove('show');
            
            // 更新导航状态
            document.querySelectorAll('.nav-item, .nav-sub-item').forEach(item => {
                item.classList.remove('active');
            });
            document.querySelectorAll('.nav-sub-item')[2].classList.add('active');
        }

        function confirmInfoComplete() {
            showPage('photoPage');
            updateHeader('上传照片');
            
            // 更新导航状态
            document.querySelectorAll('.nav-item, .nav-sub-item').forEach(item => {
                item.classList.remove('active');
            });
            document.querySelectorAll('.nav-sub-item')[4].classList.add('active');
        }

        function forceSubmit() {
            document.getElementById('confirmModal').classList.remove('show');
            confirmInfoComplete();
        }

        function takePhoto() {
            // 模拟拍照
            document.getElementById('photoPreview').innerHTML = '<div style="color: #4285f4; font-size: 40px;">📸</div>';
            document.getElementById('photoPreview').classList.add('has-image');
            document.getElementById('uploadBtn').style.display = 'inline-block';
            hasPhoto = true;
        }

        function uploadPhoto() {
            startProcessing();
        }

        function skipPhoto() {
            hasPhoto = false;
            startProcessing();
        }

        function startProcessing() {
            showPage('processPage');
            updateHeader('处理中');
            
            // 更新导航状态
            document.querySelectorAll('.nav-item, .nav-sub-item').forEach(item => {
                item.classList.remove('active');
            });
            document.querySelectorAll('.nav-sub-item')[5].classList.add('active');
            
            // 模拟处理过程
            setTimeout(() => {
                document.getElementById('aiStep').classList.add('completed');
                document.getElementById('aiStep').classList.remove('processing');
                document.getElementById('aiStep').textContent = '✓';
                document.getElementById('orderStep').classList.add('processing');
                document.getElementById('orderStep').classList.remove('pending');
            }, 2000);

            setTimeout(() => {
                completeProcess();
            }, 4000);
        }

        function completeProcess() {
            document.getElementById('orderStep').classList.add('completed');
            document.getElementById('orderStep').classList.remove('processing');
            document.getElementById('orderStep').textContent = '✓';
            document.getElementById('dispatchStep').classList.add('processing');
            document.getElementById('dispatchStep').classList.remove('pending');

            setTimeout(() => {
                document.getElementById('dispatchStep').classList.add('completed');
                document.getElementById('dispatchStep').classList.remove('processing');
                document.getElementById('dispatchStep').textContent = '✓';
                
                setTimeout(() => {
                    showPage('completePage');
                    updateHeader('报修完成');
                    
                    // 更新导航状态
                    document.querySelectorAll('.nav-item, .nav-sub-item').forEach(item => {
                        item.classList.remove('active');
                    });
                    document.querySelectorAll('.nav-sub-item')[2].classList.add('active');
                }, 1000);
            }, 2000);
        }

        function resetToEntry() {
            showPage('entryPage');
            updateHeader('机井报修');
            
            // 更新导航状态
            document.querySelectorAll('.nav-item, .nav-sub-item').forEach(item => {
                item.classList.remove('active');
            });
            document.querySelectorAll('.nav-item')[0].classList.add('active');
            
            // 重置所有状态
            isRecording = false;
            hasPhoto = false;
            currentWellInfo = {
                number: '01号机井',
                location: '村东南角农田',
                distance: '约50米'
            };
            
            // 重置对话状态
            conversationState = {
                faultType: '',
                userName: '',
                userPhone: '',
                messages: [],
                currentStep: 0
            };
            
            // 重置聊天界面
            if (document.getElementById('chatMessages')) {
                const chatMessages = document.getElementById('chatMessages');
                chatMessages.innerHTML = `
                    <div class="message ai">
                        <div class="message-bubble">
                            您好！我是AI助手，请告诉我机井的故障情况，我会帮您记录报修信息。
                        </div>
                        <div class="message-time">刚刚</div>
                    </div>
                `;
            }
            
            // 重置信息状态和提交按钮
            updateInfoStatus();
            if (document.getElementById('submitConversationBtn')) {
                document.getElementById('submitConversationBtn').classList.remove('show');
            }
            
            // 重置照片上传页面
            document.getElementById('photoPreview').innerHTML = '<div class="upload-icon">📷</div>';
            document.getElementById('photoPreview').classList.remove('has-image');
            document.getElementById('uploadBtn').style.display = 'none';
            
            // 重置手动输入
            document.getElementById('wellNumberInput').value = '';
            document.getElementById('wellLocationInput').value = '';
            
            // 重置处理步骤
            document.getElementById('aiStep').className = 'step-icon processing';
            document.getElementById('aiStep').textContent = '🤖';
            document.getElementById('orderStep').className = 'step-icon pending';
            document.getElementById('orderStep').textContent = '📋';
            document.getElementById('dispatchStep').className = 'step-icon pending';
            document.getElementById('dispatchStep').textContent = '👨‍🔧';
        }
    </script>
</body>
</html> 